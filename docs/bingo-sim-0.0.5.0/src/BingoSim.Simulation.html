<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE BangPatterns   #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE BinaryLiterals #-}</span><span>
</span><a name="line-3"></a><span>
</span><a name="line-4"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-5"></a><span class="hs-comment">-- Description: &#8592; Start here</span><span>
</span><a name="line-6"></a><span class="hs-comment">--</span><span>
</span><a name="line-7"></a><span class="hs-comment">-- Simulates the likelyhood of winning a children's carnival bingo game.</span><span>
</span><a name="line-8"></a><span class="hs-comment">--</span><span>
</span><a name="line-9"></a><span class="hs-comment">-- The game itself works like this:</span><span>
</span><a name="line-10"></a><span class="hs-comment">--</span><span>
</span><a name="line-11"></a><span class="hs-comment">-- 1. There's a 6 x 6 grid, each with it's own special character identifying it.</span><span>
</span><a name="line-12"></a><span class="hs-comment">-- 2. There are 36 tiles, one for each grid space.</span><span>
</span><a name="line-13"></a><span class="hs-comment">-- 3. Initially, all tiles are face down.</span><span>
</span><a name="line-14"></a><span class="hs-comment">-- 4. To play, a contestant chooses 15 of the 36 tiles and flips them over.</span><span>
</span><a name="line-15"></a><span class="hs-comment">-- 5. The contestant places the flipped tiles onto the correct spots.</span><span>
</span><a name="line-16"></a><span class="hs-comment">-- 6. If placing the 15 tiles forms a bingo in any row, column, or full</span><span>
</span><a name="line-17"></a><span class="hs-comment">--    diagonal, it's a win. Otherwise, it's a loss.</span><span>
</span><a name="line-18"></a><span class="hs-comment">--</span><span>
</span><a name="line-19"></a><span class="hs-comment">-- Our question is: if one of our friends wins this game, how lucky should they</span><span>
</span><a name="line-20"></a><span class="hs-comment">-- consider themself? Rather than compute the probability exactly, here we run</span><span>
</span><a name="line-21"></a><span class="hs-comment">-- a simulation to approximate the exact probability of a win.</span><span>
</span><a name="line-22"></a><span class="hs-comment">--</span><span>
</span><a name="line-23"></a><span class="hs-comment">-- To represent a bingo board and the operations on them, we've created the</span><span>
</span><a name="line-24"></a><span class="hs-comment">-- 'Board' type, which is a bit vector representing the grid in row major order</span><span>
</span><a name="line-25"></a><span class="hs-comment">-- where a @1@ means that a tile was placed on that grid space. There is also a</span><span>
</span><a name="line-26"></a><span class="hs-comment">-- 'hasBingo' helper to figure out whether a 'Board' has a bingo.</span><span>
</span><a name="line-27"></a><span class="hs-comment">--</span><span>
</span><a name="line-28"></a><span class="hs-comment">-- This module has the logic to actually carry out the simulation:</span><span>
</span><a name="line-29"></a><span class="hs-comment">-- 'runSimulation'</span><span>
</span><a name="line-30"></a><span class="hs-comment">--</span><span>
</span><a name="line-31"></a><span class="hs-comment">-- (Note: This module is basically the @Main@ module, except I couldn't figure</span><span>
</span><a name="line-32"></a><span class="hs-comment">-- out how to generate Haddock documentation for an executable target, not a</span><span>
</span><a name="line-33"></a><span class="hs-comment">-- library target.)</span><span>
</span><a name="line-34"></a><span>
</span><a name="line-35"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">BingoSim.Simulation</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-36"></a><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Monad</span><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Bits</span><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.IORef</span><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Word</span><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Text.Printf</span><span>
</span><a name="line-42"></a><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span>           </span><a href="BingoSim.Board.html"><span class="hs-identifier">BingoSim.Board</span></a><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span>           </span><a href="BingoSim.Prng.html"><span class="hs-identifier">BingoSim.Prng</span></a><span>  </span><span class="hs-special">(</span><a href="BingoSim.Prng.html#mkState"><span class="hs-identifier hs-var">mkState</span></a><span class="hs-special">,</span><span> </span><a href="BingoSim.Prng.html#next"><span class="hs-identifier hs-var">next</span></a><span class="hs-special">)</span><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="BingoSim.Prng.html"><span class="hs-identifier">BingoSim.Prng</span></a><span>  </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Prng</span><span>
</span><a name="line-46"></a><span>
</span><a name="line-47"></a><span class="hs-comment">-- | Run the entire simulation, consisting of @trials@ trials.</span><span>
</span><a name="line-48"></a><span class="hs-comment">--</span><span>
</span><a name="line-49"></a><span class="hs-comment">-- Prints the results to stdout when done.</span><span>
</span><a name="line-50"></a><span class="hs-comment">--</span><span>
</span><a name="line-51"></a><span class="hs-comment">-- &gt;&gt;&gt; runSimulation 100000</span><span>
</span><a name="line-52"></a><span class="hs-comment">-- Trials:   100000</span><span>
</span><a name="line-53"></a><span class="hs-comment">-- Bingos:   3615</span><span>
</span><a name="line-54"></a><span class="hs-comment">-- Hit rate: 0.03615</span><span>
</span><a name="line-55"></a><span class="hs-comment">--</span><span>
</span><a name="line-56"></a><span class="hs-comment">-- This function is called directly by the @bingo-sim@ executable's @main@</span><span>
</span><a name="line-57"></a><span class="hs-comment">-- method, so you can get the same effect by running @bingo-sim@ at the command</span><span>
</span><a name="line-58"></a><span class="hs-comment">-- line, instead of the Haskell REPL:</span><span>
</span><a name="line-59"></a><span class="hs-comment">--</span><span>
</span><a name="line-60"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-61"></a><span class="hs-comment">-- &#10095; bingo-sim 100000</span><span>
</span><a name="line-62"></a><span class="hs-comment">-- Trials:   100000</span><span>
</span><a name="line-63"></a><span class="hs-comment">-- Bingos:   3615</span><span>
</span><a name="line-64"></a><span class="hs-comment">-- Hit rate: 0.03615</span><span>
</span><a name="line-65"></a><span class="hs-comment">-- @</span><span>
</span><a name="line-66"></a><span class="hs-identifier">runSimulation</span><span>
</span><a name="line-67"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ @trials@: The number of trials to run.</span><span>
</span><a name="line-68"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-69"></a><a name="runSimulation"><a href="BingoSim.Simulation.html#runSimulation"><span class="hs-identifier">runSimulation</span></a></a><span> </span><a name="local-6989586621679028205"><a href="#local-6989586621679028205"><span class="hs-identifier">trials</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-70"></a><span>  </span><a name="local-6989586621679028246"><a href="#local-6989586621679028246"><span class="hs-identifier">count</span></a></a><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">newIORef</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-71"></a><span>  </span><a name="local-6989586621679028247"><a href="#local-6989586621679028247"><span class="hs-identifier">genRef</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">newIORef</span><span> </span><span class="hs-special">(</span><a href="BingoSim.Prng.html#mkState"><span class="hs-identifier hs-var">mkState</span></a><span> </span><span class="hs-number">111</span><span> </span><span class="hs-number">222</span><span> </span><span class="hs-number">333</span><span> </span><span class="hs-number">444</span><span class="hs-special">)</span><span>
</span><a name="line-72"></a><span>
</span><a name="line-73"></a><span>  </span><span class="hs-identifier hs-var">replicateM_</span><span> </span><a href="#local-6989586621679028205"><span class="hs-identifier hs-var">trials</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-74"></a><span>    </span><a name="local-6989586621679028248"><a href="#local-6989586621679028248"><span class="hs-identifier">gen</span></a></a><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">readIORef</span><span> </span><a href="#local-6989586621679028247"><span class="hs-identifier hs-var">genRef</span></a><span>
</span><a name="line-75"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679028249"><a href="#local-6989586621679028249"><span class="hs-identifier">board</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679028250"><a href="#local-6989586621679028250"><span class="hs-identifier">gen'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="BingoSim.Simulation.html#randomBoard"><span class="hs-identifier hs-var">randomBoard</span></a><span> </span><a href="#local-6989586621679028248"><span class="hs-identifier hs-var">gen</span></a><span>
</span><a name="line-76"></a><span>    </span><span class="hs-identifier hs-var">writeIORef</span><span> </span><a href="#local-6989586621679028247"><span class="hs-identifier hs-var">genRef</span></a><span> </span><a href="#local-6989586621679028250"><span class="hs-identifier hs-var">gen'</span></a><span>
</span><a name="line-77"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="BingoSim.Board.html#hasBingo"><span class="hs-identifier hs-var">hasBingo</span></a><span> </span><a href="#local-6989586621679028249"><span class="hs-identifier hs-var">board</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-78"></a><span>      </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">modifyIORef</span><span> </span><a href="#local-6989586621679028246"><span class="hs-identifier hs-var">count</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-79"></a><span>      </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-80"></a><span>
</span><a name="line-81"></a><span>  </span><a name="local-6989586621679028251"><a href="#local-6989586621679028251"><span class="hs-identifier">bingos</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">readIORef</span><span> </span><a href="#local-6989586621679028246"><span class="hs-identifier hs-var">count</span></a><span>
</span><a name="line-82"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679028252"><a href="#local-6989586621679028252"><span class="hs-identifier">rate</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679028251"><span class="hs-identifier hs-var">bingos</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">/</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679028205"><span class="hs-identifier hs-var">trials</span></a><span class="hs-special">)</span><span>
</span><a name="line-83"></a><span>  </span><span class="hs-identifier hs-var">printf</span><span> </span><span class="hs-string">&quot;Trials:   %d\n&quot;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679028205"><span class="hs-identifier hs-var">trials</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span>
</span><a name="line-84"></a><span>  </span><span class="hs-identifier hs-var">printf</span><span> </span><span class="hs-string">&quot;Bingos:   %d\n&quot;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679028251"><span class="hs-identifier hs-var">bingos</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span>
</span><a name="line-85"></a><span>  </span><span class="hs-identifier hs-var">printf</span><span> </span><span class="hs-string">&quot;Hit rate: %f\n&quot;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679028252"><span class="hs-identifier hs-var">rate</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Float</span><span class="hs-special">)</span><span>
</span><a name="line-86"></a><span>
</span><a name="line-87"></a><span class="hs-comment">-- * Simulation helpers</span><span>
</span><a name="line-88"></a><span>
</span><a name="line-89"></a><span class="hs-comment">-- | Generate a random board.</span><span>
</span><a name="line-90"></a><span class="hs-comment">--</span><span>
</span><a name="line-91"></a><span class="hs-comment">-- Uses a somewhat contrived strategy:</span><span>
</span><a name="line-92"></a><span class="hs-comment">--</span><span>
</span><a name="line-93"></a><span class="hs-comment">-- 1. Start with a bit sequence with fifteen 1's (@0x7fff@).</span><span>
</span><a name="line-94"></a><span class="hs-comment">-- 2. Use [Fisher-Yates](https://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle) to shuffle the individual bits among the lower 36 bits of the sequence.</span><span>
</span><a name="line-95"></a><span class="hs-comment">--</span><span>
</span><a name="line-96"></a><span class="hs-comment">-- This is much faster than the naive strategy of:</span><span>
</span><a name="line-97"></a><span class="hs-comment">--</span><span>
</span><a name="line-98"></a><span class="hs-comment">-- 1. Generate the numbers @0@ to @35@ in a list and shuffle them.</span><span>
</span><a name="line-99"></a><span class="hs-comment">-- 2. Take the first 15, to represent picking 15 random tiles.</span><span>
</span><a name="line-100"></a><span class="hs-comment">-- 3. Flip on the bits corresponding to each tile we picked.</span><span>
</span><a name="line-101"></a><span class="hs-comment">--</span><span>
</span><a name="line-102"></a><span class="hs-comment">-- The Fisher-Yates on bits approach is faster because we don't have to</span><span>
</span><a name="line-103"></a><span class="hs-comment">-- generate a linked list of thunks and instead can operate on a single 64-bit</span><span>
</span><a name="line-104"></a><span class="hs-comment">-- word.</span><span>
</span><a name="line-105"></a><span class="hs-comment">--</span><span>
</span><a name="line-106"></a><span class="hs-comment">-- The sacrifice is that the naive strategy nearly exactly matches our</span><span>
</span><a name="line-107"></a><span class="hs-comment">-- intuition for how this game works in the real world.</span><span>
</span><a name="line-108"></a><span class="hs-identifier">randomBoard</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="BingoSim.Prng.html#State"><span class="hs-identifier hs-type">Prng.State</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="BingoSim.Board.html#Board"><span class="hs-identifier hs-type">Board</span></a><span class="hs-special">,</span><span> </span><a href="BingoSim.Prng.html#State"><span class="hs-identifier hs-type">Prng.State</span></a><span class="hs-special">)</span><span>
</span><a name="line-109"></a><a name="randomBoard"><a href="BingoSim.Simulation.html#randomBoard"><span class="hs-identifier">randomBoard</span></a></a><span> </span><a name="local-6989586621679028760"><a href="#local-6989586621679028760"><span class="hs-identifier">gen</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-110"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679028761"><a href="#local-6989586621679028761"><span class="hs-identifier">board</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a href="BingoSim.Board.html#Board"><span class="hs-identifier hs-var">Board</span></a><span> </span><span class="hs-number">0x7fff</span><span>
</span><a name="line-111"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679028762"><a href="#local-6989586621679028762"><span class="hs-identifier">result</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="BingoSim.Simulation.html#shuffleBits"><span class="hs-identifier hs-var">shuffleBits</span></a><span> </span><a href="#local-6989586621679028760"><span class="hs-identifier hs-var">gen</span></a><span> </span><a href="#local-6989586621679028761"><span class="hs-identifier hs-var">board</span></a><span> </span><span class="hs-number">36</span><span>
</span><a name="line-112"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679028762"><span class="hs-identifier hs-var">result</span></a><span>
</span><a name="line-113"></a><span>
</span><a name="line-114"></a><span class="hs-comment">-- | Implements [Fisher-Yates](https://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle) at the bit level for a 'Board'.</span><span>
</span><a name="line-115"></a><span class="hs-comment">--</span><span>
</span><a name="line-116"></a><span class="hs-comment">-- Uses recursion to swap the current bit into place, from most to least</span><span>
</span><a name="line-117"></a><span class="hs-comment">-- significant.</span><span>
</span><a name="line-118"></a><span class="hs-identifier">shuffleBits</span><span>
</span><a name="line-119"></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="BingoSim.Prng.html#State"><span class="hs-identifier hs-type">Prng.State</span></a><span>
</span><a name="line-120"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="BingoSim.Board.html#Board"><span class="hs-identifier hs-type">Board</span></a><span>
</span><a name="line-121"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ @n@: The current bit we're considering swapping or leaving alone (1-indexed).</span><span>
</span><a name="line-122"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="BingoSim.Board.html#Board"><span class="hs-identifier hs-type">Board</span></a><span class="hs-special">,</span><span> </span><a href="BingoSim.Prng.html#State"><span class="hs-identifier hs-type">Prng.State</span></a><span class="hs-special">)</span><span>
</span><a name="line-123"></a><a name="shuffleBits"><a href="BingoSim.Simulation.html#shuffleBits"><span class="hs-identifier">shuffleBits</span></a></a><span> </span><a name="local-6989586621679028763"><a href="#local-6989586621679028763"><span class="hs-identifier">gen</span></a></a><span> </span><a name="local-6989586621679028764"><a href="#local-6989586621679028764"><span class="hs-identifier">board</span></a></a><span>      </span><span class="hs-number">1</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679028764"><span class="hs-identifier hs-var">board</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679028763"><span class="hs-identifier hs-var">gen</span></a><span class="hs-special">)</span><span>
</span><a name="line-124"></a><span class="hs-identifier">shuffleBits</span><span> </span><a name="local-6989586621679028765"><a href="#local-6989586621679028765"><span class="hs-identifier">gen</span></a></a><span> </span><span class="hs-special">(</span><a href="BingoSim.Board.html#Board"><span class="hs-identifier hs-var">Board</span></a><span> </span><a name="local-6989586621679028766"><a href="#local-6989586621679028766"><span class="hs-identifier">bs</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679028767"><a href="#local-6989586621679028767"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="BingoSim.Prng.html#next"><span class="hs-identifier hs-var">next</span></a><span> </span><a href="#local-6989586621679028765"><span class="hs-identifier hs-var">gen</span></a><span> </span><a href="#local-6989586621679028769"><span class="hs-identifier hs-var">withRand</span></a><span>
</span><a name="line-125"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-126"></a><span>  </span><a name="local-6989586621679028768"><a href="#local-6989586621679028768"><span class="hs-identifier">n'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679028767"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-127"></a><span>  </span><a name="local-6989586621679028769"><a href="#local-6989586621679028769"><span class="hs-identifier">withRand</span></a></a><span> </span><a name="local-6989586621679028770"><a href="#local-6989586621679028770"><span class="hs-identifier">rand</span></a></a><span> </span><a name="local-6989586621679028771"><a href="#local-6989586621679028771"><span class="hs-identifier">gen'</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-128"></a><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679028772"><a href="#local-6989586621679028772"><span class="hs-identifier">i</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679028770"><span class="hs-identifier hs-var">rand</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mod</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679028767"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-129"></a><span>        </span><span class="hs-glyph">!</span><a name="local-6989586621679028773"><a href="#local-6989586621679028773"><span class="hs-identifier">bs'</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="BingoSim.Simulation.html#swapBits"><span class="hs-identifier hs-var">swapBits</span></a><span> </span><a href="#local-6989586621679028766"><span class="hs-identifier hs-var">bs</span></a><span> </span><a href="#local-6989586621679028768"><span class="hs-identifier hs-var">n'</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679028772"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span>
</span><a name="line-130"></a><span>        </span><span class="hs-glyph">!</span><a name="local-6989586621679028774"><a href="#local-6989586621679028774"><span class="hs-identifier">result</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="BingoSim.Simulation.html#shuffleBits"><span class="hs-identifier hs-var">shuffleBits</span></a><span> </span><a href="#local-6989586621679028771"><span class="hs-identifier hs-var">gen'</span></a><span> </span><span class="hs-special">(</span><a href="BingoSim.Board.html#Board"><span class="hs-identifier hs-var">Board</span></a><span> </span><a href="#local-6989586621679028773"><span class="hs-identifier hs-var">bs'</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679028768"><span class="hs-identifier hs-var">n'</span></a><span>
</span><a name="line-131"></a><span>    </span><span class="hs-keyword">in</span><span>  </span><a href="#local-6989586621679028774"><span class="hs-identifier hs-var">result</span></a><span>
</span><a name="line-132"></a><span>
</span><a name="line-133"></a><span class="hs-comment">-- | Helper for swapping two specific bits.</span><span>
</span><a name="line-134"></a><span class="hs-comment">--</span><span>
</span><a name="line-135"></a><span class="hs-comment">-- Graciously taken from Sean Eron Anderson's [Bit Twiddling</span><span>
</span><a name="line-136"></a><span class="hs-comment">-- Hacks](https://graphics.stanford.edu/~seander/bithacks.html#SwappingBitsXOR),</span><span>
</span><a name="line-137"></a><span class="hs-comment">-- specialized to the case of a length 1 range of bits.</span><span>
</span><a name="line-138"></a><span class="hs-identifier">swapBits</span><span>
</span><a name="line-139"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word64</span><span> </span><span class="hs-comment">-- ^ Input bits</span><span>
</span><a name="line-140"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ @i@: Index of one bit to swap</span><span>
</span><a name="line-141"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ @j@: Index of the other bit to swap</span><span>
</span><a name="line-142"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Word64</span><span> </span><span class="hs-comment">-- ^ Swapped result</span><span>
</span><a name="line-143"></a><a name="swapBits"><a href="BingoSim.Simulation.html#swapBits"><span class="hs-identifier">swapBits</span></a></a><span> </span><a name="local-6989586621679028775"><a href="#local-6989586621679028775"><span class="hs-identifier">bs</span></a></a><span> </span><a name="local-6989586621679028776"><a href="#local-6989586621679028776"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-6989586621679028777"><a href="#local-6989586621679028777"><span class="hs-identifier">j</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679028776"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679028777"><span class="hs-identifier hs-var">j</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679028775"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-144"></a><span class="hs-identifier">swapBits</span><span> </span><a name="local-6989586621679028778"><a href="#local-6989586621679028778"><span class="hs-identifier">bs</span></a></a><span> </span><a name="local-6989586621679028779"><a href="#local-6989586621679028779"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-6989586621679028780"><a href="#local-6989586621679028780"><span class="hs-identifier">j</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-145"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><a name="local-6989586621679028781"><a href="#local-6989586621679028781"><span class="hs-identifier">x</span></a></a><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-var">shiftR</span><span> </span><a href="#local-6989586621679028778"><span class="hs-identifier hs-var">bs</span></a><span> </span><a href="#local-6989586621679028779"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">xor</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">shiftR</span><span> </span><a href="#local-6989586621679028778"><span class="hs-identifier hs-var">bs</span></a><span> </span><a href="#local-6989586621679028780"><span class="hs-identifier hs-var">j</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.&amp;.</span><span> </span><span class="hs-number">0x1</span><span>
</span><a name="line-146"></a><span>      </span><span class="hs-glyph">!</span><a name="local-6989586621679028782"><a href="#local-6989586621679028782"><span class="hs-identifier">result</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679028778"><span class="hs-identifier hs-var">bs</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">xor</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-var">shiftL</span><span> </span><a href="#local-6989586621679028781"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679028779"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.|.</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">shiftL</span><span> </span><a href="#local-6989586621679028781"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679028780"><span class="hs-identifier hs-var">j</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-147"></a><span>  </span><span class="hs-keyword">in</span><span>  </span><a href="#local-6989586621679028782"><span class="hs-identifier hs-var">result</span></a><span>
</span><a name="line-148"></a><span>
</span><a name="line-149"></a></pre></body></html>