<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>BingoSim.Simulation</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/BingoSim.Simulation.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">bingo-sim-0.0.5.0: A small playground to learn about profiling Haskell.</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">BingoSim.Simulation</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Simulation helpers</a></li></ul></div><div id="description"><p class="caption">Description</p><div class="doc"><p>Simulates the likelyhood of winning a children's carnival bingo game.</p><p>The game itself works like this:</p><ol><li>There's a 6 x 6 grid, each with it's own special character identifying it.</li><li>There are 36 tiles, one for each grid space.</li><li>Initially, all tiles are face down.</li><li>To play, a contestant chooses 15 of the 36 tiles and flips them over.</li><li>The contestant places the flipped tiles onto the correct spots.</li><li>If placing the 15 tiles forms a bingo in any row, column, or full
    diagonal, it's a win. Otherwise, it's a loss.</li></ol><p>Our question is: if one of our friends wins this game, how lucky should they
 consider themself? Rather than compute the probability exactly, here we run
 a simulation to approximate the exact probability of a win.</p><p>To represent a bingo board and the operations on them, we've created the
 <code><a href="BingoSim-Board.html#t:Board" title="BingoSim.Board">Board</a></code> type, which is a bit vector representing the grid in row major order
 where a <code>1</code> means that a tile was placed on that grid space. There is also a
 <code><a href="BingoSim-Board.html#v:hasBingo" title="BingoSim.Board">hasBingo</a></code> helper to figure out whether a <code><a href="BingoSim-Board.html#t:Board" title="BingoSim.Board">Board</a></code> has a bingo.</p><p>This module has the logic to actually carry out the simulation:
 <code><a href="BingoSim-Simulation.html#v:runSimulation" title="BingoSim.Simulation">runSimulation</a></code></p><p>(Note: This module is basically the <code>Main</code> module, except I couldn't figure
 out how to generate Haddock documentation for an executable target, not a
 library target.)</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><a href="#v:runSimulation">runSimulation</a> :: <a href="../base-4.12.0.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> ()</li><li class="src short"><a href="#v:randomBoard">randomBoard</a> :: <a href="BingoSim-Prng.html#t:State" title="BingoSim.Prng">State</a> -&gt; <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="BingoSim-Board.html#t:Board" title="BingoSim.Board">Board</a>, <a href="BingoSim-Prng.html#t:State" title="BingoSim.Prng">State</a>)</li><li class="src short"><a href="#v:shuffleBits">shuffleBits</a> :: <a href="BingoSim-Prng.html#t:State" title="BingoSim.Prng">State</a> -&gt; <a href="BingoSim-Board.html#t:Board" title="BingoSim.Board">Board</a> -&gt; <a href="../base-4.12.0.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; (<a href="BingoSim-Board.html#t:Board" title="BingoSim.Board">Board</a>, <a href="BingoSim-Prng.html#t:State" title="BingoSim.Prng">State</a>)</li><li class="src short"><a href="#v:swapBits">swapBits</a> :: <a href="../base-4.12.0.0/Data-Word.html#t:Word64" title="Data.Word">Word64</a> -&gt; <a href="../base-4.12.0.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.12.0.0/Data-Int.html#t:Int" title="Data.Int">Int</a> -&gt; <a href="../base-4.12.0.0/Data-Word.html#t:Word64" title="Data.Word">Word64</a></li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><a id="v:runSimulation" class="def">runSimulation</a> <a href="src/BingoSim.Simulation.html#runSimulation" class="link">Source</a> <a href="#v:runSimulation" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="../base-4.12.0.0/Data-Int.html#t:Int" title="Data.Int">Int</a></td><td class="doc"><p><code>trials</code>: The number of trials to run.</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> ()</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Run the entire simulation, consisting of <code>trials</code> trials.</p><p>Prints the results to stdout when done.</p><pre class="screen"><code class="prompt">&gt;&gt;&gt; </code><strong class="userinput"><code>runSimulation 100000
</code></strong>Trials:   100000
Bingos:   3615
Hit rate: 0.03615
</pre><p>This function is called directly by the <code>bingo-sim</code> executable's <code>main</code>
 method, so you can get the same effect by running <code>bingo-sim</code> at the command
 line, instead of the Haskell REPL:</p><pre>&#10095; bingo-sim 100000
Trials:   100000
Bingos:   3615
Hit rate: 0.03615
</pre></div></div><a href="#g:1" id="g:1"><h1>Simulation helpers</h1></a><div class="top"><p class="src"><a id="v:randomBoard" class="def">randomBoard</a> :: <a href="BingoSim-Prng.html#t:State" title="BingoSim.Prng">State</a> -&gt; <a href="../base-4.12.0.0/System-IO.html#t:IO" title="System.IO">IO</a> (<a href="BingoSim-Board.html#t:Board" title="BingoSim.Board">Board</a>, <a href="BingoSim-Prng.html#t:State" title="BingoSim.Prng">State</a>) <a href="src/BingoSim.Simulation.html#randomBoard" class="link">Source</a> <a href="#v:randomBoard" class="selflink">#</a></p><div class="doc"><p>Generate a random board.</p><p>Uses a somewhat contrived strategy:</p><ol><li>Start with a bit sequence with fifteen 1's (<code>0x7fff</code>).</li><li>Use <a href="https://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle">Fisher-Yates</a> to shuffle the individual bits among the lower 36 bits of the sequence.</li></ol><p>This is much faster than the naive strategy of:</p><ol><li>Generate the numbers <code>0</code> to <code>35</code> in a list and shuffle them.</li><li>Take the first 15, to represent picking 15 random tiles.</li><li>Flip on the bits corresponding to each tile we picked.</li></ol><p>The Fisher-Yates on bits approach is faster because we don't have to
 generate a linked list of thunks and instead can operate on a single 64-bit
 word.</p><p>The sacrifice is that the naive strategy nearly exactly matches our
 intuition for how this game works in the real world.</p></div></div><div class="top"><p class="src"><a id="v:shuffleBits" class="def">shuffleBits</a> <a href="src/BingoSim.Simulation.html#shuffleBits" class="link">Source</a> <a href="#v:shuffleBits" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="BingoSim-Prng.html#t:State" title="BingoSim.Prng">State</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="BingoSim-Board.html#t:Board" title="BingoSim.Board">Board</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">-&gt; <a href="../base-4.12.0.0/Data-Int.html#t:Int" title="Data.Int">Int</a></td><td class="doc"><p><code>n</code>: The current bit we're considering swapping or leaving alone (1-indexed).</p></td></tr><tr><td class="src">-&gt; (<a href="BingoSim-Board.html#t:Board" title="BingoSim.Board">Board</a>, <a href="BingoSim-Prng.html#t:State" title="BingoSim.Prng">State</a>)</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>Implements <a href="https://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle">Fisher-Yates</a> at the bit level for a <code><a href="BingoSim-Board.html#t:Board" title="BingoSim.Board">Board</a></code>.</p><p>Uses recursion to swap the current bit into place, from most to least
 significant.</p></div></div><div class="top"><p class="src"><a id="v:swapBits" class="def">swapBits</a> <a href="src/BingoSim.Simulation.html#swapBits" class="link">Source</a> <a href="#v:swapBits" class="selflink">#</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="../base-4.12.0.0/Data-Word.html#t:Word64" title="Data.Word">Word64</a></td><td class="doc"><p>Input bits</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.12.0.0/Data-Int.html#t:Int" title="Data.Int">Int</a></td><td class="doc"><p><code>i</code>: Index of one bit to swap</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.12.0.0/Data-Int.html#t:Int" title="Data.Int">Int</a></td><td class="doc"><p><code>j</code>: Index of the other bit to swap</p></td></tr><tr><td class="src">-&gt; <a href="../base-4.12.0.0/Data-Word.html#t:Word64" title="Data.Word">Word64</a></td><td class="doc"><p>Swapped result</p></td></tr></table></div><div class="doc"><p>Helper for swapping two specific bits.</p><p>Graciously taken from Sean Eron Anderson's <a href="https://graphics.stanford.edu/~seander/bithacks.html#SwappingBitsXOR">Bit Twiddling
 Hacks</a>,
 specialized to the case of a length 1 range of bits.</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.22.0</p></div></body></html>